Выполнил задачу на PostgreSQL 9.6. 
Выполняю для себя, т.к. когда-то работал SQL разработчиком и надеюсь когда-нибудь в дальнейшем вернуться к этому :)